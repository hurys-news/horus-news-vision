# حورس نيوز - منصة إخبارية عربية مع Supabase

تم تحديث مشروع حورس نيوز لاستخدام Supabase كخدمة خلفية لتخزين البيانات والمصادقة.

## التحديثات

تم إضافة المميزات التالية:

- تخزين البيانات في قاعدة بيانات Supabase
- نظام مصادقة متكامل باستخدام Supabase Auth
- إدارة المستخدمين والأدوار
- تخزين الأخبار والفئات والتعليقات
- سياسات أمان الصفوف (Row Level Security)

## التقنيات المستخدمة

- **الواجهة الأمامية**: React, TypeScript, Vite
- **التصميم**: Tailwind CSS, shadcn/ui
- **إدارة الحالة**: React Query
- **التوجيه**: React Router
- **قاعدة البيانات**: Supabase
- **المصادقة**: Supabase Auth

## متطلبات التشغيل

- Node.js (الإصدار 18 أو أحدث)
- npm أو yarn
- حساب Supabase

## التثبيت والإعداد

1. تثبيت التبعيات:
   ```bash
   npm install
   ```

2. إنشاء ملف `.env` في المجلد الرئيسي وإضافة متغيرات البيئة:
   ```
   VITE_SUPABASE_URL=https://your-project-url.supabase.co
   VITE_SUPABASE_ANON_KEY=your-anon-key
   ```

3. إعداد قاعدة بيانات Supabase:
   - قم بإنشاء مشروع جديد على [Supabase](https://supabase.com)
   - قم بتنفيذ الأوامر SQL الموجودة في ملف `supabase/schema.sql`
   - قم بتنفيذ الأوامر SQL الموجودة في ملف `supabase/audit_log.sql`

4. تشغيل المشروع في وضع التطوير:
   ```bash
   npm run dev
   ```

## هيكل قاعدة البيانات

### جدول الفئات (categories)
- `id`: معرف فريد (UUID)
- `name`: اسم الفئة
- `slug`: معرف الفئة في عنوان URL
- `description`: وصف الفئة (اختياري)
- `image`: رابط صورة الفئة (اختياري)
- `parent_id`: معرف الفئة الأم (للفئات الفرعية)
- `created_at`: تاريخ الإنشاء
- `updated_at`: تاريخ التحديث

### جدول الكتّاب (authors)
- `id`: معرف فريد (UUID)
- `name`: اسم الكاتب
- `avatar`: رابط صورة الكاتب (اختياري)
- `title`: المسمى الوظيفي للكاتب (اختياري)
- `bio`: نبذة عن الكاتب (اختياري)
- `created_at`: تاريخ الإنشاء
- `updated_at`: تاريخ التحديث

### جدول الأخبار (news)
- `id`: معرف فريد (UUID)
- `title`: عنوان الخبر
- `excerpt`: ملخص الخبر
- `content`: محتوى الخبر (اختياري)
- `category_id`: معرف الفئة
- `image`: رابط صورة الخبر (اختياري)
- `created_at`: تاريخ النشر
- `updated_at`: تاريخ التحديث
- `source`: مصدر الخبر (اختياري)
- `author_id`: معرف الكاتب (اختياري)
- `is_top_story`: هل الخبر مميز؟
- `is_breaking`: هل الخبر عاجل؟
- `view_count`: عدد المشاهدات
- `tags`: وسوم الخبر (مصفوفة)

### جدول الملفات الشخصية (profiles)
- `id`: معرف فريد (UUID)
- `user_id`: معرف المستخدم (مرتبط بجدول المستخدمين في Supabase)
- `name`: اسم المستخدم
- `avatar`: رابط صورة المستخدم (اختياري)
- `role`: دور المستخدم (user, editor, admin)
- `saved_news`: الأخبار المحفوظة (مصفوفة من المعرفات)
- `followed_categories`: الفئات المتابعة (مصفوفة من المعرفات)
- `created_at`: تاريخ الإنشاء
- `updated_at`: تاريخ التحديث

### جدول التعليقات (comments)
- `id`: معرف فريد (UUID)
- `news_id`: معرف الخبر
- `user_id`: معرف المستخدم
- `content`: محتوى التعليق
- `created_at`: تاريخ النشر
- `likes`: عدد الإعجابات
- `parent_id`: معرف التعليق الأب (للردود على التعليقات)

### جدول سجل التغييرات (audit_log)
- `id`: معرف فريد (UUID)
- `action`: نوع الإجراء (إضافة، تعديل، حذف)
- `user_id`: معرف المستخدم الذي قام بالإجراء
- `content`: وصف الإجراء
- `created_at`: تاريخ الإجراء

## سياسات أمان الصفوف (Row Level Security)

تم تكوين سياسات أمان الصفوف لضمان أن:
- الجميع يمكنهم قراءة البيانات العامة (الأخبار، الفئات، الكتّاب، التعليقات).
- المستخدمون المسجلون فقط يمكنهم إضافة تعليقات.
- المستخدمون يمكنهم تعديل وحذف تعليقاتهم فقط.
- المحررون والمسؤولون فقط يمكنهم إضافة وتعديل الأخبار.
- المسؤولون فقط يمكنهم إضافة وتعديل وحذف الفئات والكتّاب.
- المسؤولون يمكنهم حذف أي تعليق.

## الملفات الجديدة

- `src/lib/supabase.ts`: تكوين عميل Supabase
- `src/lib/auth.ts`: خدمة المصادقة باستخدام Supabase
- `src/types/supabase.ts`: أنواع البيانات لـ Supabase
- `src/contexts/AuthContext.tsx`: سياق المصادقة لإدارة حالة المستخدم
- `supabase/schema.sql`: أوامر SQL لإنشاء جداول Supabase
- `supabase/audit_log.sql`: أوامر SQL لإنشاء جدول سجل التغييرات
- `supabase/README.md`: توثيق تكامل Supabase

## الملفات المعدلة

- `src/lib/api.ts`: تم تحديثه لاستخدام Supabase بدلاً من البيانات الوهمية
- `src/pages/Login.tsx`: تم تحديثه لاستخدام خدمة المصادقة الجديدة
- `src/pages/ForgotPassword.tsx`: تم تحديثه لاستخدام خدمة المصادقة الجديدة
- `src/pages/Admin.tsx`: تم تحديثه لاستخدام Supabase بدلاً من البيانات الوهمية
- `src/components/AdminButton.tsx`: تم تحديثه لاستخدام خدمة المصادقة الجديدة
- `src/App.tsx`: تم تحديثه لاستخدام AuthProvider

## التحديثات الأخيرة

- تم ربط لوحة التحكم بـ Supabase لإدارة المحتوى
- تم إضافة وظائف إنشاء وتعديل وحذف الأخبار باستخدام Supabase
- تم إضافة سجل التغييرات (Audit Log) لتتبع التغييرات في المحتوى
- تم تحسين واجهة المستخدم في لوحة التحكم

## الخطوات التالية

1. إنشاء صفحة تسجيل مستخدم جديد
2. إنشاء صفحة الملف الشخصي للمستخدم
3. إضافة وظائف حفظ الأخبار ومتابعة الفئات
4. تحسين نظام إدارة المستخدمين في لوحة التحكم
