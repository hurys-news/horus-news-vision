# تكامل Supabase مع مشروع حورس نيوز

هذا الدليل يشرح كيفية إعداد وتكوين Supabase كخدمة خلفية لمشروع حورس نيوز.

## الخطوات

### 1. إنشاء مشروع Supabase

1. قم بزيارة [supabase.com](https://supabase.com/) وقم بتسجيل الدخول أو إنشاء حساب جديد.
2. انقر على "New Project" لإنشاء مشروع جديد.
3. أدخل اسم المشروع (مثل "horus-news") واختر كلمة مرور قوية لقاعدة البيانات.
4. اختر المنطقة الأقرب إليك لاستضافة المشروع.
5. انقر على "Create new project" وانتظر حتى يتم إنشاء المشروع (قد يستغرق ذلك بضع دقائق).

### 2. إعداد قاعدة البيانات

1. بعد إنشاء المشروع، انتقل إلى قسم "SQL Editor" في لوحة التحكم.
2. انسخ محتوى ملف `schema.sql` الموجود في هذا المجلد والصقه في محرر SQL.
3. انقر على "Run" لتنفيذ الأوامر وإنشاء الجداول وسياسات الأمان.

### 3. تكوين المصادقة

1. انتقل إلى قسم "Authentication" في لوحة التحكم.
2. في علامة التبويب "Settings"، قم بتكوين الإعدادات التالية:
   - تأكد من تمكين "Email auth" للسماح بالمصادقة عبر البريد الإلكتروني وكلمة المرور.
   - قم بتعيين "Site URL" إلى عنوان URL لموقعك (مثل `https://horusnews.com`).
   - أضف عناوين URL المسموح بها للتوجيه بعد تسجيل الدخول (مثل `https://horusnews.com/login`).

### 4. الحصول على بيانات الاتصال

1. انتقل إلى قسم "Settings" > "API" في لوحة التحكم.
2. ستجد هناك:
   - عنوان URL للمشروع (Project URL)
   - مفتاح API العام (anon key)
   - مفتاح API الخدمة (service role key) - احتفظ به سريًا!

### 5. تكوين متغيرات البيئة

1. قم بتحديث ملف `.env` في مشروعك بالقيم التالية:
   ```
   VITE_SUPABASE_URL=https://your-project-url.supabase.co
   VITE_SUPABASE_ANON_KEY=your-anon-key
   ```

## هيكل قاعدة البيانات

### جدول الفئات (categories)
- `id`: معرف فريد (UUID)
- `name`: اسم الفئة
- `slug`: معرف الفئة في عنوان URL
- `description`: وصف الفئة (اختياري)
- `image`: رابط صورة الفئة (اختياري)
- `parent_id`: معرف الفئة الأم (للفئات الفرعية)
- `created_at`: تاريخ الإنشاء
- `updated_at`: تاريخ التحديث

### جدول الكتّاب (authors)
- `id`: معرف فريد (UUID)
- `name`: اسم الكاتب
- `avatar`: رابط صورة الكاتب (اختياري)
- `title`: المسمى الوظيفي للكاتب (اختياري)
- `bio`: نبذة عن الكاتب (اختياري)
- `created_at`: تاريخ الإنشاء
- `updated_at`: تاريخ التحديث

### جدول الأخبار (news)
- `id`: معرف فريد (UUID)
- `title`: عنوان الخبر
- `excerpt`: ملخص الخبر
- `content`: محتوى الخبر (اختياري)
- `category_id`: معرف الفئة
- `image`: رابط صورة الخبر (اختياري)
- `created_at`: تاريخ النشر
- `updated_at`: تاريخ التحديث
- `source`: مصدر الخبر (اختياري)
- `author_id`: معرف الكاتب (اختياري)
- `is_top_story`: هل الخبر مميز؟
- `is_breaking`: هل الخبر عاجل؟
- `view_count`: عدد المشاهدات
- `tags`: وسوم الخبر (مصفوفة)

### جدول الملفات الشخصية (profiles)
- `id`: معرف فريد (UUID)
- `user_id`: معرف المستخدم (مرتبط بجدول المستخدمين في Supabase)
- `name`: اسم المستخدم
- `avatar`: رابط صورة المستخدم (اختياري)
- `role`: دور المستخدم (user, editor, admin)
- `saved_news`: الأخبار المحفوظة (مصفوفة من المعرفات)
- `followed_categories`: الفئات المتابعة (مصفوفة من المعرفات)
- `created_at`: تاريخ الإنشاء
- `updated_at`: تاريخ التحديث

### جدول التعليقات (comments)
- `id`: معرف فريد (UUID)
- `news_id`: معرف الخبر
- `user_id`: معرف المستخدم
- `content`: محتوى التعليق
- `created_at`: تاريخ النشر
- `likes`: عدد الإعجابات
- `parent_id`: معرف التعليق الأب (للردود على التعليقات)

## سياسات أمان الصفوف (Row Level Security)

تم تكوين سياسات أمان الصفوف لضمان أن:
- الجميع يمكنهم قراءة البيانات العامة (الأخبار، الفئات، الكتّاب، التعليقات).
- المستخدمون المسجلون فقط يمكنهم إضافة تعليقات.
- المستخدمون يمكنهم تعديل وحذف تعليقاتهم فقط.
- المحررون والمسؤولون فقط يمكنهم إضافة وتعديل الأخبار.
- المسؤولون فقط يمكنهم إضافة وتعديل وحذف الفئات والكتّاب.
- المسؤولون يمكنهم حذف أي تعليق.
