# إعداد CORS في Supabase للتكامل مع موقع حورس نيوز

يشرح هذا الدليل كيفية إعداد CORS (Cross-Origin Resource Sharing) في Supabase للسماح بالاتصال من موقع حورس نيوز المنشور على Vercel أو أي خادم آخر.

## ما هو CORS ولماذا نحتاجه؟

CORS هو آلية أمان تستخدمها المتصفحات للتحقق من أن الطلبات من مصدر (origin) معين مسموح لها بالوصول إلى الموارد على خادم آخر. عند نشر موقع حورس نيوز على Vercel أو أي خادم آخر، سيحتاج إلى الاتصال بخادم Supabase، وبالتالي يجب إعداد CORS للسماح بهذا الاتصال.

## خطوات إعداد CORS في Supabase

1. قم بتسجيل الدخول إلى حسابك على [Supabase](https://supabase.com/).
2. انتقل إلى مشروع حورس نيوز.
3. انقر على "Settings" في القائمة الجانبية.
4. انقر على "API" في القائمة الفرعية.
5. انتقل إلى قسم "CORS" (Cross-Origin Resource Sharing).
6. في حقل "Additional Allowed Origins"، أضف عناوين URL للمواقع التي ستتصل بـ Supabase:
   - للتطوير المحلي: `http://localhost:8081`
   - للموقع المنشور على Vercel: `https://your-project.vercel.app`
   - للمجال المخصص (إن وجد): `https://your-domain.com`

   ![إعداد CORS في Supabase](https://i.imgur.com/example-image.png)

7. انقر على زر "Save" لحفظ الإعدادات.

## التحقق من إعدادات CORS

بعد إعداد CORS، يمكنك التحقق من أنه يعمل بشكل صحيح:

1. قم بزيارة موقع حورس نيوز المنشور.
2. انتقل إلى `/supabase-test` للتحقق من الاتصال بقاعدة بيانات Supabase.
3. تأكد من أن الاتصال ناجح وأن البيانات تظهر بشكل صحيح.
4. افتح وحدة تحكم المتصفح (F12 > Console) للتأكد من عدم وجود أخطاء CORS.

## أخطاء CORS الشائعة وحلولها

إذا واجهت أخطاء CORS، فقد تظهر رسائل مثل:

```
Access to fetch at 'https://your-project.supabase.co/rest/v1/...' from origin 'https://your-project.vercel.app' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

الحلول المحتملة:

1. **تأكد من إضافة عنوان URL الصحيح**: تأكد من إضافة عنوان URL الدقيق للموقع المنشور، بما في ذلك البروتوكول (http/https) والمجال الفرعي (إن وجد).
2. **انتظر انتشار التغييرات**: قد تستغرق تغييرات CORS بعض الوقت لتنتشر. انتظر بضع دقائق وحاول مرة أخرى.
3. **تحقق من البروتوكول**: تأكد من استخدام HTTPS للموقع المنشور وليس HTTP.
4. **مسح ذاكرة التخزين المؤقت للمتصفح**: قم بمسح ذاكرة التخزين المؤقت للمتصفح وإعادة تحميل الصفحة.

## ملاحظات هامة

- لأسباب أمنية، لا تضف `*` كأصل مسموح به إلا في بيئة التطوير.
- تأكد من إضافة جميع المجالات التي ستستخدم لاختبار أو نشر موقع حورس نيوز.
- إذا قمت بتغيير عنوان URL للموقع المنشور، تأكد من تحديث إعدادات CORS في Supabase.
- إذا كنت تستخدم مجالات فرعية متعددة، فستحتاج إلى إضافة كل منها بشكل منفصل.
